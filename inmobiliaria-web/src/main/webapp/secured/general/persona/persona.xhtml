<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:fn="http://java.sun.com/jsp/jstl/functions" xmlns:p="http://primefaces.org/ui">
<f:view>
	<h:head>
		<title>#{msg['msg.tituloPrincipal']}</title>
	</h:head>
	<h:body>
		<ui:composition template="/layouts/default.xhtml">
			<ui:define name="content">
				<p:outputPanel id="pnlGeneral">
					<script>
						function onFinishDownload() {
							var btn = $('.btn_hide_delete');
							btn.click();
						}
					</script>
					<h:panelGroup rendered="#{personaBean.person eq null}" id="personList">
						<div class="col-sm-12">
							<div class="box">
								<p:messages id="messages" showDetail="true" autoUpdate="false" closable="true" globalOnly="true" for="form1, loadData" />
								<div class="box-header with-border">
									<label class="title-head">#{msg['lbl.managerPerson']}</label>
								</div>
								<div class="box-body">
									<div class="col-sm-12 x_title panel-heading">
										<label class="subtitle-head">#{msg['lbl.listadoPersonas']}</label>
										<div class="clearfix"></div>
										<div class="col-sm-4"
											style="width: auto; float: left; margin: 15px;">
											<h:outputLabel for="loadData" value="Subir archivo" />
											<h:form id="loadData" prependId="false" enctype="multipart/form-data">
												<p:fileUpload label="Elegir archivo" process="@form" fileUploadListener="#{personaBean.loadDataExcel}"
													mode="advanced" allowTypes="/(\.|\/)(xlsx)$/" invalidFileMessage="Error: Tipo de archivo invalido"
													update=":tablaregistros" dragDropSupport="true" uploadLabel="Cargar" cancelLabel="Cancelar">
												</p:fileUpload>
											</h:form>
										</div>
										<div class="div-btn-header">
											<h:form id="formReport" prependId="false">
												<p:commandButton
													onclick="PrimeFaces.monitorDownload(null, onFinishDownload)"
													title="Generar EXCEL" ajax="false" process="@this"
													actionListener="#{personaBean.exportarExcel()}"
													rendered="#{personaBean.person eq null}" update="@this"
													styleClass="btn-ic" icon="ic-btn ic-btn-excel">
													<p:fileDownload value="#{personaBean.download}"></p:fileDownload>
												</p:commandButton>
												<p:commandButton
													onclick="PrimeFaces.monitorDownload(null, onFinishDownload)"
													title="Generar PDF" ajax="false" process="@this"
													actionListener="#{personaBean.generarReporte()}"
													rendered="#{personaBean.person eq null}" update="@this"
													styleClass="btn-ic" icon="ic-btn ic-btn-download">
													<p:fileDownload value="#{personaBean.download}">
													</p:fileDownload>
												</p:commandButton>
												<p:commandButton styleClass="btn_hide_delete"
													process="@this"
													actionListener="#{personaBean.onFinishDownload()}"
													style="display:none">
												</p:commandButton>
												<p:commandButton title="#{msg['lbl.nuevo']}" process="@this"
													action="#{personaBean.nuevo()}"
													rendered="#{personaBean.person eq null}"
													update="pnlGeneral ,formRegisterPerson"
													onstart="showSpinner();" onsuccess="hideSpinner();"
													styleClass="btn-ic" icon="ic-btn ic-btn-new" />
											</h:form>
										</div>
										<div class="clearfix"></div>
									</div>
									<h:form id="form1" prependId="false">
										<div class="col-sm-12">
											<p:outputPanel id="tablaregistros">
												<div class="panel-body form-table">
													<p:dataTable id="tblPersonas" widgetVar="table1" var="person" value="#{personaBean.persons}" rows="10" paginator="true" paginatorAlwaysVisible="false" paginatorPosition="bottom"
														paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" emptyMessage="No se encontraron registros" rowsPerPageTemplate="5,10,15">
														<p:column style="width:130px;" headerText="#{msg['lbl.identificacion']}" priority="2" filterBy="#{person.identification}" filterMatchMode="contains">
															<h:outputText value="#{person.identification}" />
														</p:column>
														<p:column headerText="#{msg['lbl.persona']}" sortBy="#{person.firstName}" priority="1" filterBy="#{person.firstName} #{person.secondName} #{person.lastName} #{person.secondLastName}" filterMatchMode="contains">
															<h:outputText style="text-transform: capitalize" value="#{person.firstName} #{person.secondName} #{person.lastName} #{person.secondLastName}" />
														</p:column>
														<p:column style="width:180px;" headerText="#{msg['lbl.municipio']}" filterBy="#{person.municipality.name}" sortBy="#{person.municipality.name}" priority="2" filterMatchMode="contains">
															<h:outputText value="#{person.municipality.name}" />
														</p:column>
														<p:column style="width:200px;" headerText="#{msg['lbl.direccion']}" priority="4" filterBy="#{person.address}" filterMatchMode="contains">
															<h:outputText value="#{person.address}" />
														</p:column>
														<p:column style="width:200px;" priority="3" headerText="Email">
															<h:outputText value="#{person.email}" />
														</p:column>
														<p:column style="width:200px;" priority="3" headerText="Fecha de Registro" sortBy="#{person.registered}">
															<h:outputText value="#{person.registered}" />
														</p:column>
														<p:column width="70">
															<p:commandButton process="@this" action="#{personaBean.loadPerson(person)}" update="pnlGeneral, formRegisterPerson" title="#{msg['lbl.editar']}" icon="ic-btn-little ic-btn-edit" styleClass="btn-ic-little" onstart="showSpinner();" onsuccess="hideSpinner();" />
														</p:column>
													</p:dataTable>
												</div>
											</p:outputPanel>
										</div>
									</h:form>
								</div>
							</div>
						</div>
					</h:panelGroup>
				</p:outputPanel>
				<h:form prependId="false" id="formRegisterPerson">
					<h:panelGroup rendered="#{personaBean.person ne null}">
						<div class="col-sm-12">
							<div class="box">
								<div class="box-header with-border">
									<label class="title-head">#{msg['lbl.managerPerson']}</label>
								</div>
								<div class="box-body">
									<div class="col-sm-12 x_title panel-heading">
										<label class="subtitle-head">#{personaBean.person.id eq null ? 'Registrar' : 'Editar'} Persona</label>
										<div class="clearfix"></div>
									</div>
									<div class="form-group">
										<div class="form-group col-md-3">
											<label for="txt_firstName" class="col-sm-12 control-label required">Primer Nombre</label>
											<h:inputText type="text" class="form-control" id="txt_firstName" placeholder="Primer Nombre" value="#{personaBean.person.firstName}" required="true" requiredMessage="#{msg['obligatoryField']}" />
											<p:message for="txt_firstName" />
										</div>
										<div class="form-group col-md-3">
											<label for="secondName" class="col-sm-12 control-label">Segundo Nombre</label>
											<h:inputText type="text" class="form-control" id="secondName" placeholder="Segundo Nombre" value="#{personaBean.person.secondName}" />
										</div>
										<div class="form-group col-md-3">
											<label for="lastName" class="col-sm-12 control-label required">Primer Apellido</label>
											<h:inputText type="text" class="form-control" id="lastName" placeholder="Primer Apellido" value="#{personaBean.person.lastName}" required="true" requiredMessage="#{msg['obligatoryField']}" />
											<p:message for="lastName" />
										</div>
										<div class="form-group col-md-3">
											<label for="secondLastName" class="col-sm-12 control-label">Segundo Apellido</label>
											<h:inputText type="text" class="form-control" id="secondLastName" placeholder="Segundo Apellido" value="#{personaBean.person.secondLastName}" />
										</div>
									</div>
									<div class="clearfix"></div>
									<div class="form-group">
										<div class="form-group col-md-3 col-sm-3">
											<label for="identificationType" class="col-sm-12 control-label required">Tipo de identificación</label>
											<h:selectOneMenu required="true" styleClass="form-control" id="identificationType" value="#{personaBean.person.tipoDocumento}" var="d" converter="hdsConvertEntity" requiredMessage="#{msg['obligatoryFieldList']}">
												<f:converter converterId="hdsConvertEntity" />
												<f:selectItem itemLabel="Tipo de Documento" />
												<f:selectItems value="#{personaBean.documentTypeList}" var="doc" itemLabel="#{doc.tipoDocumento}" itemValue="#{doc}" />
											</h:selectOneMenu>
											<p:message for="identificationType" />
										</div>
										<div class="form-group col-md-3 col-sm-3">
											<label for="identification" class="col-sm-12 control-label required">Identificación</label>
											<h:inputText type="text" class="form-control" id="identification" placeholder="Identificación" value="#{personaBean.person.identification}" required="true" requiredMessage="#{msg['obligatoryField']}" />
											<p:message for="identification" />
										</div>
										<div class="form-group col-md-3 col-sm-3">
											<label for="telephone" class="col-sm-12 control-label">Telefono</label>
											<h:inputText type="text" class="form-control" id="telephone" placeholder="Telefono" value="#{personaBean.person.telefono}" />
										</div>
										<div class="form-group col-md-3 col-sm-3">
											<label for="movil" class="col-sm-12 control-label">Celular</label>
											<h:inputText type="text" class="form-control" id="celular" placeholder="Celular" value="#{personaBean.person.movil}" />
										</div>
									</div>
									<div class="clearfix"></div>
									<div class="form-group">
										<div class="form-group col-md-3 col-sm-3" >
											<label for="department" class="col-sm-12 control-label required">Departamento</label>
											<h:selectOneMenu required="true" styleClass="form-control" id="department" value="#{personaBean.department}" requiredMessage="#{msg['obligatoryFieldList']}">
												<f:converter converterId="hdsConvertEntity" />
												<f:selectItem itemLabel="Seleccione un Departamento" />
												<f:selectItems value="#{personaBean.departmentList}" var="dep" itemLabel="#{dep.name}" itemValue="#{dep}" />
												<p:ajax event="change" update="municipality" process="@this" listener="#{personaBean.loadMunicipalities()}" />
											</h:selectOneMenu>
											<p:message for="department"/>
										</div>
										<div class="form-group col-md-3 col-sm-3" >
											<label for="municipality" class="col-sm-12 control-label required">Municipio</label>
											<h:selectOneMenu required="true" styleClass="form-control" id="municipality" value="#{personaBean.person.municipality}" requiredMessage="#{msg['obligatoryFieldList']}">
												<f:converter converterId="hdsConvertEntity" />
												<f:selectItem itemLabel="Seleccione un Municipio" />
												<f:selectItems value="#{personaBean.municipalityList}" var="mun" itemLabel="#{mun.name}" itemValue="#{mun}" />
											</h:selectOneMenu>
											<p:message for="municipality" />
										</div>
										<div class="form-group col-md-3 col-sm-3" >
											<label for="address" class="col-sm-12 control-label required">Dirección</label>
											<h:inputText type="text" class="form-control" id="address" placeholder="Dirección" value="#{personaBean.person.address}" required="true" requiredMessage="#{msg['obligatoryField']}" />
											<p:message for="address" />
										</div>
										<div class="form-group col-md-3 col-sm-3">
											<label for="email" class="col-sm-12 control-label">Email</label>
											<h:inputText type="text" class="form-control" id="email" placeholder="Email" value="#{personaBean.person.email}" required="true" requiredMessage="#{msg['obligatoryField']}" validatorMessage="Formato de email invalido">
												<f:validateRegex pattern="^[_A-Za-z0-9-\+]+(\.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\.[A-Za-z0-9]+)*(\.[A-Za-z]{2,})$" />
											</h:inputText>
											<p:message for="email" />
										</div>
									</div>
									<div class="clearfix"></div>
									<div class="form-group">
										<div class="col-md-3 col-sm-3">
											<div class="">
												<label class="col-sm-12 control-label required">Fecha de nacimiento</label>
											</div>
											<div class="col-md-12 col-sm-12">
												<p:calendar pattern="dd-MM-yyyy" styleClass="ui-calendar" id="date" value="#{personaBean.person.birthdate}" />
											</div>
										</div>
										<div class="form-group col-md-3 col-sm-3">
											<label for="sex" class="col-sm-12 control-label required">Sexo</label>
											<p:selectOneRadio required="true" id="sex" value="#{personaBean.person.sexo}" requiredMessage="#{msg['obligatoryField']}">
												<f:selectItem class="radio-inline" itemLabel="Masculino" itemValue="M" />
												<f:selectItem class="radio-inline" itemLabel="Femenino" itemValue="F" />
											</p:selectOneRadio>
											<p:message for="sex" />
										</div>
									</div>
									<div class="clearfix"></div>
								</div>
								<div class="box-footer">
									<div class="ln_solid"></div>
									<div class="form-group">
										<div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-4">
											<p:commandButton process="@form" action="#{personaBean.savePerson()}" styleClass="btn-ic" icon="ic-btn ic-btn-save" update="pnlGeneral,formRegisterPerson,messages" onstart="PF('statusDialog').show();" onsuccess="PF('statusDialog').hide();" />
											<p:commandButton title="#{msg['lbl.cancelar']}" process="@this" styleClass="btn-ic" icon="ic-btn ic-btn-cancel" action="#{personaBean.cancel()}" update="pnlGeneral ,formRegisterPerson" />
										</div>
									</div>
								</div>
							</div>
						</div>
					</h:panelGroup>
				</h:form>
			</ui:define>
		</ui:composition>
	</h:body>
</f:view>
</html>