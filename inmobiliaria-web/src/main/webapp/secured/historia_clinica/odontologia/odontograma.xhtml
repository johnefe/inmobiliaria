<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:p="http://primefaces.org/ui">
<f:view>
	<h:head>
		<title>#{msg['msg.tituloPrincipal']}</title>
		<style type="text/css">
#myCanvas {
	border: 1px solid #9C9898;
}

#myCanvas2 {
	border: 1px solid #9C9898;
}

#myCanvas3 {
	border: 1px solid #9C9898;
}

#myCanvas4 {
	border: 1px solid #9C9898;
}
</style>

		<script type="text/javascript">
$(document).ready(function() {
	$('#radio').change(function() {
		accion = $("input[name='accion']:checked").val();
		if (accion == 'borrar') {
			$("#radio_seccion").show('blind', 500);
			} 
		else {
			$("#radio_seccion").hide();
			}
		});
});
</script>

	</h:head>

	<h:body>
		<ui:composition template="/layouts/default.xhtml">
			<ui:define name="content">

				<h:form prependId="false" id="form1" enctype="multipart/form-data">
					<div class="col-sm-12">
						<div class="box">
							<p:messages id="messages" showDetail="true" autoUpdate="false"
								closable="true" globalOnly="true" for="form1" />
							<div class="box-header with-border">
								<label class="title-box">#{msg['lbl.odontograma']}</label>
							</div>
							<div class="box-body">
								<!-- espacio de prueba -->
								<div id="radio">
									<input type="radio" id="radio1" name="accion" value="fractura"
										checked="checked" /><label for="radio1">Fractura</label> <input
										type="radio" id="radio2" name="accion" value="restauracion" /><label
										for="radio2">Restauracion</label> <input type="radio"
										id="radio3" name="accion" value="borrar" /><label
										for="radio3">Borrar</label> <input type="radio" id="radio4"
										name="accion" value="extraccion" /><label for="radio4">Extraccion</label>
									<input type="radio" id="radio5" name="accion" value="puente" /><label
										for="radio5">Puente</label>
								</div>
								<br></br>
								<div id="canvasesdiv"
									style="position: relative; width: 870px; height: 300px">
									<canvas id="myCanvas" width="870" height="300"
										style="z-index: 1;  position:absolute; left:0px; top:0px;"></canvas>
									<canvas id="myCanvas2" width="870" height="300"
										style="z-index: 2; position:absolute; left:0px; top:0px;"></canvas>
									<canvas id="myCanvas3" width="870" height="300"
										style="z-index: 3; position:absolute;  left:0px; top:0px;"></canvas>
									<canvas id="myCanvas4" width="870" height="300"
										style="z-index: 4; position:absolute; left:0px; top:0px;"></canvas>
								</div>
								<div id="radio_seccion" style='display: none'>
									<input type="radio" id="radio_1" name="seccion" value="seccion"
										checked="checked" /><label for="radio_1">Seccion</label> <input
										type="radio" id="radio_2" name="seccion" value="diente" /><label
										for="radio_2">Diente</label>
								</div>

<script type="text/javascript">
								
// Funcion para dibujar las lineas de cada diente
	function dibuja_contorno(context, inicio_x,inicio_y, med, separacion_x,separacion_y) {
		var ctx = context;
		// Definiendo puntos de dibujo
		cua = med / 4;
		ter = cua * 3;
		/* 1ra zona */
		if (ctx) {
			ctx.strokeStyle = color_line;
			ctx.beginPath();
			ctx.moveTo(inicio_x, inicio_y);
			ctx.lineTo(med + inicio_x,inicio_y);
			ctx.lineTo(ter + inicio_x, cua + inicio_y);
			ctx.lineTo(cua + inicio_x, cua + inicio_y);
			ctx.closePath();
			ctx.stroke();
		}
		/* 2da zona */
		if (ctx) {
			ctx.strokeStyle = color_line;
			ctx.beginPath();
			ctx.moveTo(ter + inicio_x, cua + inicio_y);
			ctx.lineTo(med + inicio_x, inicio_y);
			ctx.lineTo(med + inicio_x, med + inicio_y);
			ctx.lineTo(ter + inicio_x, ter + inicio_y);
			ctx.closePath();
			ctx.stroke();
		}
		/* 3ra zona */
		if (ctx) {
			ctx.strokeStyle = color_line;
			ctx.beginPath();
			ctx.moveTo(cua + inicio_x, ter + inicio_y);
			ctx.lineTo(ter + inicio_x, ter + inicio_y);
			ctx.lineTo(med + inicio_x, med + inicio_y);
			ctx.lineTo(inicio_x, med + inicio_y);
			ctx.closePath();
			ctx.stroke();
		}
		/* 4ta zona */
		if (ctx) {
			ctx.strokeStyle = color_line;
			ctx.beginPath();
			ctx.moveTo(inicio_x, inicio_y);
			ctx.lineTo(cua + inicio_x, cua + inicio_y);
			ctx.lineTo(cua + inicio_x, ter + inicio_y);
			ctx.lineTo(inicio_x, med + inicio_y);
			ctx.closePath();
			ctx.stroke();
		}
		
	}
										
	// Funcion para pintar una region del diente
    function dibuja_seccion(contexto, num_diente, seccion, color_pas) {
        var ctx = contexto;
        // Definiendo puntos de dibujo
        med = medida;
        cua = med / 4;
        ter = cua * 3;
        num_diente = num_diente - 2;
        color_line = color_pas;
        if (num_diente &lt; 16) {
            inicio_y = 20;
        } else {
            num_diente = num_diente -16;
            inicio_y = 20;
        }
        //alert(num_diente);
        
        alert("diente:"+num_diente);
        inicio_x =  (num_diente * med) + (separacion_x * num_diente) + separacion_x;
        /* 1ra zona */
        if (seccion == 1) {
            if (ctx) {
                ctx.fillStyle = color_line;
                ctx.beginPath();
                ctx.moveTo(inicio_x, inicio_y);
                ctx.lineTo(med + inicio_x, inicio_y);
                ctx.lineTo(ter + inicio_x, cua + inicio_y);
                ctx.lineTo(cua + inicio_x, cua + inicio_y);
                ctx.closePath();
                ctx.fill();
                ctx.strokeStyle = 'black';
                ctx.stroke();
            }
        }
        /* 2da zona */
        if (seccion == 2) {
            if (ctx) {
                ctx.fillStyle = color_line;
                ctx.beginPath();
                ctx.moveTo(ter + inicio_x, cua + inicio_y);
                ctx.lineTo(med + inicio_x, inicio_y);
                ctx.lineTo(med + inicio_x, med + inicio_y);
                ctx.lineTo(ter + inicio_x, ter + inicio_y);
                ctx.closePath();
                ctx.fill();
                ctx.strokeStyle = 'black';
                ctx.stroke();
            }
        }
        /* 3ra zona */
        if (seccion == 3) {
            if (ctx) {
                ctx.fillStyle = color_line;
                ctx.beginPath();
                ctx.moveTo(cua + inicio_x, ter + inicio_y);
                ctx.lineTo(ter + inicio_x, ter + inicio_y);
                ctx.lineTo(med + inicio_x, med + inicio_y);
                ctx.lineTo(inicio_x, med + inicio_y);
                ctx.closePath();
                ctx.fill();
                ctx.strokeStyle = 'black';
                ctx.stroke();
            }
        }
        /* 4ta zona */
        if (seccion == 4) {
            if (ctx) {
                ctx.fillStyle = color_line;
                ctx.beginPath();
                ctx.moveTo(inicio_x, inicio_y);
                ctx.lineTo(cua + inicio_x, cua + inicio_y);
                ctx.lineTo(cua + inicio_x, ter + inicio_y);
                ctx.lineTo(inicio_x, med + inicio_y);
                ctx.closePath();
                ctx.fill();
                ctx.strokeStyle = 'black';
                ctx.stroke();
            }
        }
        /* 5ta zona(medio) */
        if (seccion == 5) {
            if (ctx) {
                ctx.fillStyle = color_line;
                ctx.beginPath();
                ctx.moveTo(cua + inicio_x, cua + inicio_y);
                ctx.lineTo(ter + inicio_x, cua + inicio_y);
                ctx.lineTo(ter + inicio_x, ter + inicio_y);
                ctx.lineTo(cua + inicio_x, ter + inicio_y);
                ctx.closePath();
                ctx.fill();
                ctx.strokeStyle = 'black';
                ctx.stroke();
            }
        }
    }	
	//--------------------------------------
	// Funcion para sombrear
        // function marcar_seccion(contexto, num_diente, seccion, color_pas) {
          //   var ctx = contexto;
            // Definiendo puntos de dibujo
         //    med = medida;
         //   cua = med / 4;
          //   ter = cua * 3;
            // num_diente = num_diente - 1;
         //    color_line = color_pas;
          //   inicio_y=20;
            //  //alert(num_diente);
           //  inicio_x = (num_diente * med) + (separacion_x * num_diente) + separacion_x;
            /* 1ra zona */
           
            /* 2da zona */
          
            /* 3ra zona */
          
            /* 4ta zona */
            
            /* 5ta zona(medio) */
         
      //   }
        //**
									//------------------------------
		var canvas = document.getElementById('myCanvas');
        
        var context = canvas.getContext('2d');
		//
		var layer2 = document.getElementById("myCanvas2");
		var ctx2 = layer2.getContext("2d");
		//
		var layer3 = document.getElementById("myCanvas3");
		var ctx3 = layer3.getContext("2d");
		//
		var layer4 = document.getElementById("myCanvas4");
		var ctx4 = layer4.getContext("2d");
		//
		var color_line = 'black';
		var medida = 40; //tamaño del diente
		var separacion_x = 10; //espacio entre diente
		var separacion_y = 0; //espacio entre diente
		var iniciar_x = 20; //espacio en vertical
		var iniciar_y = 20; //espacio en hor
		//Dientes para el puente
		var diente1 = 0;
		var diente2 = 0;
		var diente3 = 0;
		var diente4 = 0;
		
		// 1 - 16 dientes
        for ( x = 18,  xx = 0; x &gt; 10, xx &lt; 8; x--, xx++) {
            iniciar_x = (xx * (medida / 1)) + (separacion_x * xx) + separacion_x;
            dibuja_contorno(context, iniciar_x, iniciar_y, medida, separacion_x, 10);
            /* Numero de diente */
            context.font = '10pt Calibri';
            context.textAlign = 'center';
            context.fillStyle = 'black';
            context.fillText(x, iniciar_x + (medida / 2), (iniciar_y / 2) + 5);
        }
     // 51 - 55 dientes
     	iniciar_x = 0;
        iniciar_y = medida + 40;
        for ( x = 55,  xx = 3; x &gt; 51, xx &lt; 8; x--, xx++) {
            iniciar_x = (xx * (medida / 1)) + (separacion_x * xx) + separacion_x;
            dibuja_contorno(context, iniciar_x, iniciar_y, medida, separacion_x, 10);
            /* Numero de diente */
            context.font = '10pt Calibri';
            context.textAlign = 'center';
            context.fillStyle = 'black';
            context.fillText(x, iniciar_x + (medida / 2), (iniciar_y  -10) + 5);
        }
        // 81 - 85 dientes
     	iniciar_x = 0;
        iniciar_y = medida + 140;
        for ( x = 85,  xx = 3; x &gt; 81, xx &lt; 8; x--, xx++) {
            iniciar_x = (xx * (medida / 1)) + (separacion_x * xx) + separacion_x;
            dibuja_contorno(context, iniciar_x, iniciar_y, medida, separacion_x, 10);
            /* Numero de diente */
            context.font = '10pt Calibri';
            context.textAlign = 'center';
            context.fillStyle = 'black';
            context.fillText(x, iniciar_x + (medida / 2), (iniciar_y  -10) + 5);
        }
        // 41 - 48 dientes
     	iniciar_x = 0;
        iniciar_y = medida + 200;
        for ( x = 48,  xx = 0; x &gt; 41, xx &lt; 8; x--, xx++) {
            iniciar_x = (xx * (medida / 1)) + (separacion_x * xx) + separacion_x;
            dibuja_contorno(context, iniciar_x, iniciar_y, medida, separacion_x, 10);
            /* Numero de diente */
            context.font = '10pt Calibri';
            context.textAlign = 'center';
            context.fillStyle = 'black';
            context.fillText(x, iniciar_x + (medida / 2), (iniciar_y  -10) + 5);
        }
     // 21 - 28 dientes
     	iniciar_x = 0;
        iniciar_y = medida - 20;
        for ( x = 21,  xx = 9; x &lt; 28, xx &lt; 17; x++, xx++) {
            iniciar_x = (xx * (medida / 1)) + (separacion_x * xx) + separacion_x;
            dibuja_contorno(context, iniciar_x, iniciar_y, medida, separacion_x, 10);
            /* Numero de diente */
            context.font = '10pt Calibri';
            context.textAlign = 'center';
            context.fillStyle = 'black';
            context.fillText(x, iniciar_x + (medida / 2), (iniciar_y  -10) + 5);
        }
     // 61 - 65 dientes
     	iniciar_x = 0;
        iniciar_y = medida + 40;
        for ( x = 61,  xx = 9; x &lt; 15, xx &lt; 14; x++, xx++) {
            iniciar_x = (xx * (medida / 1)) + (separacion_x * xx) + separacion_x;
            dibuja_contorno(context, iniciar_x, iniciar_y, medida, separacion_x, 10);
            /* Numero de diente */
            context.font = '10pt Calibri';
            context.textAlign = 'center';
            context.fillStyle = 'black';
            context.fillText(x, iniciar_x + (medida / 2), (iniciar_y  -10) + 5);
        }
     // 71 - 75 dientes
     	iniciar_x = 0;
        iniciar_y = medida + 140;
        for ( x = 71,  xx = 9; x &lt; 75, xx &lt; 14; x++, xx++) {
            iniciar_x = (xx * (medida / 1)) + (separacion_x * xx) + separacion_x;
            dibuja_contorno(context, iniciar_x, iniciar_y, medida, separacion_x, 10);
            /* Numero de diente */
            context.font = '10pt Calibri';
            context.textAlign = 'center';
            context.fillStyle = 'black';
            context.fillText(x, iniciar_x + (medida / 2), (iniciar_y  -10) + 5);
        }
     // 31 - 38 dientes
     	iniciar_x = 0;
        iniciar_y = medida + 200;
        for ( x = 31,  xx = 9; x &lt; 38, xx &lt; 17; x++, xx++) {
            iniciar_x = (xx * (medida / 1)) + (separacion_x * xx) + separacion_x;
            dibuja_contorno(context, iniciar_x, iniciar_y, medida, separacion_x, 10);
            /* Numero de diente */
            context.font = '10pt Calibri';
            context.textAlign = 'center';
            context.fillStyle = 'black';
            context.fillText(x, iniciar_x + (medida / 2), (iniciar_y  -10) + 5);
        }
        //dibuja_seccion(context, 2, 3, 'red');
        //dibuja_seccion(context, 18, 5, 'green');
        //dibuja_seccion(context, 24, 4, 'blue');
        window.onload = function() {
            localStorage.clear();
            click();
        }
        function click() {
            //Añadimos un addEventListener al canvas para reconocer el click
            layer4.addEventListener("click",getPosition, false);
            layer4.addEventListener("mousemove", Marcar, false);
        }
        
        function getPosition(event) {
            var x = event.x;
            var y = event.y;
            //alert(y);
           //alert(x);
            var canvas = document.getElementById("myCanvas");
            var div_can = document.getElementById("canvasesdiv");
            x -= div_can.offsetLeft;
            y -= div_can.offsetTop;
            //alert(div_can.offsetTop);
            var div = 0;
            var color = '';
            var accion = '';
            seleccion = $("input[name='accion']:checked").val();
            if (seleccion == 'fractura') {
                color = 'red';
                accion = 'seccion';
            } else if (seleccion == 'restauracion') {
                color = 'blue';
                accion = 'seccion';
            } else if (seleccion == 'extraccion') {
                color = 'black';
                accion = 'marcar';
            } else if (seleccion == 'puente') {
                accion = 'puente';
            } else if (seleccion == 'borrar') {
                accion = 'borrar';
            }
            //alert(y);
            diente = 0;
            seccion = 0;
            if (y &lt;= 20 &amp;&amp; y &gt;= 60) {
                //alert(x);
                if (x &gt;= 10 &amp;&amp; x &lt;= 50) {
                    diente = 1;
                } else if (x &gt;= 60 &amp;&amp; x &lt;= 800) {
                    div = parseInt(x / 50, 10);
                    ini = (div * 40) + (10 * div) + 10;
                    fin = ini + 40;
                    if (x &gt;= ini &amp;&amp; x &lt;= fin) {
                        diente = div + 1;
                    }
                }
            } else if (y &gt;= 140 &amp;&amp; y &lt;= 180) {
                if (x  &gt; 10 &amp;&amp; x  &lt; 50) {
                    diente = 17;
                } else if (x &gt;= 60 &amp;&amp; x &lt;= 800) {
                    div = parseInt(x / 50, 10);
                    ini = (div * 40) + (10 * div) + 10;
                    fin = ini + 40;
                    if (x &gt;= ini &amp;&amp; x &lt;= fin) {
                        diente = div + 17;
                    }
                }
            }
            
            
            if (diente) {
                //alert(diente);
                if (accion == 'seccion') {
                    x = x - ((div * 40) + (10 * div) + 10);
                    y = y - 10;
                    if (diente &gt; 16) {
                        y = y - 100;
                    }
                    //alert(y);
                    if (y &gt; 0 &amp;&amp; y &lt; 10 &amp;&amp; x &gt; y &amp;&amp; y &lt; 40 - x) {
                        seccion = 1;
                    } else if (x &gt; 30 &amp;&amp; x &lt; 40 &amp;&amp; y &lt; x &amp;&amp; 40 - x &lt; y) {
                        seccion = 2;
                    } else if (y &gt; 30 &amp;&amp; y &lt; 40 &amp;&amp; x &lt; y &amp;&amp; x &gt; 40 - y) {
                        seccion = 3;
                    } else if (x &gt; 0 &amp;&amp; x &lt; 10 &amp;&amp; y &gt; x &amp;&amp; x &lt; 40 - y) {
                        seccion = 4;
                    } else if (x &gt; 10 &amp;&amp; x &lt; 30 &amp;&amp; y &gt; 10 &amp;&amp; y &lt; 30) {
                        seccion = 5;
                    }
                } else if (accion == 'marcar') {
                    cod = diente + '-0-' + '3';
                    if (cod &amp;&amp; !localStorage.getItem(cod)) {
                        new_array = [diente, 0, 3, Date.now(), 0];
                        guardar = new_array.toLocaleString();
                        localStorage.setItem(cod, guardar);
                        marcar_extraccion(ctx2, diente, 'black')
                    } else {
                        alert("Ya fue marcado");
                    }
                } else if (accion == 'puente') {
                    if (diente1 == 0) {
                        marcar_diente(ctx4, diente, 'red');
                        diente1 = diente;
                    } else if (diente2 == 0) {
                        diente2 = diente;
                        menor = 0;
                        mayor = 0;
                        if (diente1 &gt; diente2) {
                            mayor = diente1;
                            menor = diente2;
                        } else {
                            mayor = diente2;
                            menor = diente1
                        }
                        diente1 = menor;
                        diente2 = mayor;
                        if ((diente1 &lt; 17 &amp;&amp; diente2 &lt; 17 &amp;&amp; diente1 != diente2) || (diente1 &gt; 17 &amp;&amp; diente2 &gt; 17 &amp;&amp; diente1 != diente2)) {
                            marcar_diente(ctx4, diente, 'red');
                            ctx4.clearRect(0, 0, 810, 70);
                            ctx4.clearRect(0, 135, 810, 70);
                            cod = diente1 + '-0-4-' + diente2;
                            if (cod &amp;&amp; !localStorage.getItem(cod)) {
                                new_array = [diente1, 0, 4, Date.now(), diente2];
                                guardar = new_array.toLocaleString();
                                localStorage.setItem(cod, guardar);
                            } else {
                                alert("Ya fue marcado");
                            }
                            marcar_puente(ctx4, diente1, diente2, 'red');
                        } else {
                            ctx4.clearRect(0, 0, 810, 70);
                            ctx4.clearRect(0, 135, 810, 70);
                        }

                        diente1 = 0;
                        diente2 = 0;
                    }
                } else if (accion == 'borrar') {
                    borrar_diente(ctx2, diente);
                    //cargar el ultimo pintado
                    seccion_chk = $("input[name='seccion']:checked").val();
                    if (seccion_chk == 'seccion') {
                        x = x - ((div * 40) + (10 * div) + 10);
                        y = y - 20;
                        if (diente &gt; 16) {
                            y = y - 120;
                        }
                        seccion_b = ubica_seccion(x, y);
                        if (seccion_b) {
                            ultimo = '';
                            key_cod = '';
                            for (var i = 0; i &lt; localStorage.length; i++) {
                                var key_name = localStorage.key(i);
                                item = localStorage.getItem(key_name);
                                item = item.split(',');
                                diente_comp = parseInt(item[0], 10);
                                seccion_comp = parseInt(item[1], 10);
                                accion_comp = parseInt(item[2], 10);
                                if (diente_comp == diente &amp;&amp; seccion_b == seccion_comp &amp;&amp; (accion_comp == 1 || accion_comp == 2)) {
                                    if (ultimo == '') {
                                        ultimo = item;
                                        key_cod = key_name;
                                    } else {
                                        fecha_ult = parseInt(item[3], 10);
                                        if (ultimo[3] &lt; fecha_ult) {
                                            ultimo = item;
                                            key_cod = key_name;
                                        }
                                    }
                                }
                            }
                            if (key_cod != '') {
                                //console.log(key_cod);
                                localStorage.removeItem(key_cod);
                            }
                        }

                    } else if (seccion_chk == 'diente') {
                        ultimo = '';
                        key_cod = '';
                        for (var i = 0; i &lt; localStorage.length; i++) {
                            var key_name = localStorage.key(i);
                            item = localStorage.getItem(key_name);
                            item = item.split(',');
                            diente_comp = parseInt(item[0], 10);
                            accion_comp = parseInt(item[2], 10);
                            if (diente_comp == diente &amp;&amp; accion_comp == 3) {
                                if (ultimo == '') {
                                    ultimo = item;
                                    key_cod = key_name;
                                } else {
                                    fecha_ult = parseInt(item[3], 10);
                                    if (ultimo[3] &lt; fecha_ult) {
                                        ultimo = item;
                                        key_cod = key_name;
                                    }
                                }
                            }
                        }
                        if (key_cod != '') {
                            //console.log(key_cod);
                            //alert(key_cod);
                            localStorage.removeItem(key_cod);
                        }
                    }
                    //alert('a');
                    pinta_datos();
                }
            }
            //alert(diente);
            if (seccion &amp;&amp; color != '') {
                //alert(color);

                //alert(seccion);
                //[numero_diente, seccion, accion, fecha, diente2]
                if (color == 'red') {
                    cod = diente + '-' + seccion + '-' + '1';
                    accion_g = 1;
                } else if (color == 'blue') {
                    cod = diente + '-' + seccion + '-' + '2';
                    accion_g = 2;
                };
                if (cod &amp;&amp; !localStorage.getItem(cod)) {
                    new_array = [diente, seccion, accion_g, Date.now(), 0];
                    guardar = new_array.toLocaleString();
                    localStorage.setItem(cod, guardar);
                    dibuja_seccion(ctx2, diente, seccion, color);
                } else {
                    alert("ya fue marcado");
                }

            }
            if ('borrar' == $("input[name='accion']:checked").val()) {
                //alert("x-> "+x+" y-> "+y);
                //ctx4.clearRect(0, 0, 810, 300);

                if (x &gt;= 30 &amp;&amp; x &lt;= 780 &amp;&amp; ((y &gt; 78 &amp;&amp; y &lt; 82) || (y &gt; 198 &amp;&amp; y &lt; 202))) {
                    //alert(x);
                    div = parseInt(x / 50, 10);
                    //alert(div);
                    ultimo = '';
                    key_cod = '';
                    for (var i = 0; i &lt; localStorage.length; i++) {
                        var key_name = localStorage.key(i);
                        item = localStorage.getItem(key_name);
                        item = item.split(',');
                        diente1_comp = parseInt(item[0], 10);
                        diente2_comp = parseInt(item[4], 10);
                        accion_comp = parseInt(item[2], 10);
                        if (accion_comp == 4) {
                            if (diente1_comp &gt; 16) {
                                diente1_comp = diente1_comp - 17;
                                diente2_comp = diente2_comp - 17;
                            } else {
                                diente1_comp = diente1_comp - 1;
                                diente2_comp = diente2_comp - 1;
                            }
                            inicio_x = (diente1_comp * 40) + (10 * diente1_comp) + 10 + 20;
                            fin_X = (diente2_comp * 40) + (10 * diente2_comp) + 10 + 20;
                            if (x &gt;= inicio_x &amp;&amp; x &lt;= fin_x) {
                                if (ultimo == '') {
                                    ultimo = item;
                                    key_cod = key_name;
                                } else {
                                    fecha_ult = parseInt(item[3], 10);
                                    if (ultimo[3] &lt; fecha_ult) {
                                        ultimo = item;
                                        key_cod = key_name;
                                    }
                                }
                            }

                        }
                    }
                    if (key_cod != '') {
                        console.log(key_cod);
                        if (parseInt(ultimo[0], 10) &lt; 16) {
                            seccion_p = 1;
                            ctx4.clearRect(0, 0, 810, 130);
                        } else {
                            ctx4.clearRect(0, 130, 810, 150);
                            seccion_p = 2;
                        }
                        localStorage.removeItem(key_cod);
                        pinta_puentes(seccion_p);
                    }
                }

            }

        }
        
        //---- marcar
         function Marcar(event) {
        	//alert("hola");
            var x = event.x;
            var y = event.y;
            var canvas2 = document.getElementById("myCanvas2");
            var div_can = document.getElementById("canvasesdiv");
            x -= div_can.offsetLeft;
            y -= div_can.offsetTop;
            //alert(x);
            diente = 0;
            seccion = 0;
            var div = 0;

            if (y &gt;= 20 &amp; y &lt;= 60) {
                //alert(x);
                if (x &gt;= 10 &amp; x &lt;= 50) {
                    diente = 1;
                    //alert("1");
                } else if (x &gt;= 60 &amp; x &lt;= 800) {
                    div = parseInt(x / 50, 10);
                    ini = (div * 40) + (10 * div) + 10;
                    fin = ini + 40;
                    if (x &gt;= ini &amp; x &lt;= fin) {
                        diente = div + 1;
                    }
                }
            } else if (y &gt;= 140 &amp; y &lt;= 180) {
                if (x &gt;= 10 &amp; x &lt;= 50) {
                    diente = 17;
                } else if (x &gt;= 60 &amp; x &lt;= 800) {
                    div = parseInt(x / 50, 10);
                    ini = (div * 40) + (10 * div) + 10;
                    fin = ini + 40;
                    if (x &gt;= ini &amp; x &lt;= fin) {
                        diente = div + 17;
                    }
                }
            }
            //alert(diente);
            if (diente) {
                accion = $("input[name='accion']:checked").val();
                var seleccion = '';
                if (accion == 'fractura') {
                    seleccion = 'seccion';
                } else if (accion == 'restauracion') {
                    seleccion = 'seccion';
                } else if (accion == 'extraccion') {
                    seleccion = 'diente';
                } else if (accion == 'puente') {
                    seleccion = 'diente';
                } else if (accion == 'borrar') {
                    seccion_chk = $("input[name='seccion']:checked").val();
                    if (seccion_chk == 'diente') {
                        seleccion = 'diente';
                    } else {
                        seleccion = 'seccion';
                    }
                }
                if (seleccion == 'seccion') {
                    x = x - ((div * 40) + (10 * div) + 10);
                    y = y - 20;
                    if (diente &gt; 16) {
                        y = y - 120;
                    }
                    //alert(y);
                    /*if (y&gt;=x &amp; y&lt;=39){}*/
                    // Ubicar la seccion clickeada
                    if (y &gt; 0 &amp; y &lt; 10 &amp; x &gt; y &amp; y &lt; 40 - x) {
                        seccion = 1;
                    } else if (x &gt; 30 &amp; x &lt; 40 &amp; y &lt; x &amp; 40 - x &lt; y) {
                        seccion = 2;
                    } else if (y &gt; 30 &amp; y &lt; 40 &amp; x &lt; y &amp; x &gt; 40 - y) {
                        seccion = 3;
                    } else if (x &gt; 0 &amp; x &lt; 10 &amp; y &gt; x &amp; x &lt; 40 - y) {
                        seccion = 4;
                    } else if (x &gt; 10 &amp; x &lt; 30 &amp; y &gt; 10 &amp; y &lt; 30) {
                        seccion = 5;
                    }
                    //Comprobacion de si eta en una seccion
                   // if (seccion) {
                        //alert(seccion);
                      //   color = 'yellow';
                      //   ctx3.clearRect(0, 0, 810, 300);
                     //    marcar_seccion(ctx3, diente, seccion, color);
                    //     //alert(seccion);
                    // } else {
                        //ctx2.fillStyle = "white";
                        //ctx2.fillRect(0, 0, 810, 300);
                    //     ctx3.clearRect(0, 0, 810, 300);
                    // }
                } else if (seleccion == 'diente') {
                    ctx3.clearRect(0, 0, 810, 300);
                    marcar_diente(ctx3, diente, 'yellow');
                }
            } else {
                ctx3.clearRect(0, 0, 510, 300);
            }

            //dibuja_contorno(canvas, inicio_x, inicio_y, med, separacion_x, separacion_y)
        }
        
        
        
        //**    
								</script>

								<!-- end espacio de prueba -->
							</div>
							<div class="box-footer">#{msg['lbl.odontograma']}</div>
						</div>
					</div>
				</h:form>
			</ui:define>
		</ui:composition>

	</h:body>

</f:view>

</html>
